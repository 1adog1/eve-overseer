option_settings:
  aws:elasticbeanstalk:container:php:phpini:
    document_root: /public

files:
  "/etc/cron.d/app-run-checks":
    mode: "000644"
    owner: root
    group: root
    content: |
      * * * * * webapp . /opt/elasticbeanstalk/deployment/env-vars && cd /var/app/current && /usr/bin/flock -n /var/app/current/checks.lockfile python3 ./checker/automaticallyRunChecks.py >> checks.log 2>&1
      0 15 * * * webapp . /opt/elasticbeanstalk/deployment/env-vars && cd /var/app/current && python3 ./cronjob/cronChecks.py >> cron.log
    leader_only: true

commands:
  02_clear_cron_backup:
    command: rm -f /etc/cron.d/app-run-checks.bak
    ignoreErrors: true
  03_pip:
    command: pip3 install requests==2.29 mysql-connector-python schedule

# does not always work, restart manually after deployment
#container_commands:
#  01_kill_checker:
#    command: sudo kill $(ps aux | grep '[p]ython3 ./checker/automaticallyRunChecks.py' | awk '{print $2}') 2> /dev/null
